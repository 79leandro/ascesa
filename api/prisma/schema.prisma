// Schema do banco de dados - ASCESA
// Usando nomes em Português Brasileiro

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Usuários do sistema
model Usuario {
  id            String      @id @default(uuid())
  email         String      @unique
  senha         String      @map("password")
  nome          String      @map("name")
  cpf           String?     @unique
  telefone       String?     @map("phone")
  avatar        String?
  status        StatusUsuario @default(PENDENTE)
  papel         Papel        @default(ASSOCIADO)
  criadoEm      DateTime    @default(now()) @map("createdAt")
  atualizadoEm  DateTime    @updatedAt @map("updatedAt")
  ultimoLogin   DateTime?   @map("lastLogin")

  // Relacionamentos
  associado      Associado?
  administrador  Administrador?
  favoritos      Favorito[]
  redefinicaoSenha RedefinicaoSenha?
  documentos     Documento[]
  historicosMembership HistoricoMembership[]

  @@map("User")
}

enum StatusUsuario {
  PENDENTE @map("PENDING")
  ATIVO    @map("ACTIVE")
  INATIVO  @map("INACTIVE")
  SUSPENSO @map("SUSPENDED")
}

enum Papel {
  ADMIN    @map("ADMIN")
  DIRETOR  @map("DIRECTOR")
  ASSOCIADO @map("ASSOCIATED")
}

model RedefinicaoSenha {
  id          String   @id @default(uuid())
  usuarioId   String   @unique @map("userId")
  usuario     Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  token       String
  expiraEm    DateTime @map("expiresAt")
  usado       Boolean  @default(false) @map("used")
  criadoEm    DateTime @default(now()) @map("createdAt")

  @@map("PasswordReset")
}

// Dados específicos do associado
model Associado {
  id              String    @id @default(uuid())
  usuarioId       String    @unique @map("userId")
  usuario         Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  cpf             String
  rg              String?
  dataNascimento  DateTime? @map("birthDate")
  profissao       String?   @map("profession")
  endereco        String?   @map("address")
  cidade          String?   @map("city")
  estado          String?   @map("state")
  cep             String?   @map("zipCode")
  dataAssociacao  DateTime  @default(now()) @map("membershipDate")
  tipoMembership   TipoMembership @default(PADRAO) @map("membershipType")
  status          StatusAssociado @default(ATIVO)
  statusPagamento StatusPagamento @default(PAGO) @map("paymentStatus")
  observacoes     String?   @map("notes")
  criadoEm        DateTime  @default(now()) @map("createdAt")
  atualizadoEm    DateTime  @updatedAt @map("updatedAt")

  @@map("Associated")
}

enum TipoMembership {
  PADRAO  @map("STANDARD")
  PREMIUM @map("PREMIUM")
  FAMILIA @map("FAMILY")
}

enum StatusAssociado {
  ATIVO   @map("ACTIVE")
  INATIVO @map("INACTIVE")
  PENDENTE @map("PENDING")
  CANCELADO @map("CANCELLED")
}

enum StatusPagamento {
  PAGO     @map("PAID")
  PENDENTE @map("PENDING")
  ATRASADO @map("OVERDUE")
}

// Dados específicos do administrador
model Administrador {
  id              String    @id @default(uuid())
  usuarioId       String    @unique @map("userId")
  usuario         Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  departamento    String?   @map("department")
  cargo           String?   @map("position")
  criadoEm        DateTime  @default(now()) @map("createdAt")
  atualizadoEm    DateTime  @updatedAt @map("updatedAt")

  @@map("Admin")
}

// Convênios/Benefícios
model Beneficio {
  id              String    @id @default(uuid())
  nome            String    @map("name")
  slug            String    @unique
  descricao       String?   @map("description")
  termos          String?   @map("terms")
  categoria       String    @map("category")
  nomeParceiro    String?   @map("partnerName")
  logoParceiro    String?   @map("partnerLogo")
  desconto        String?   @map("discount")
  imagem          String?   @map("image")
  ativo           Boolean   @default(true) @map("isActive")
  destacado       Boolean   @default(false) @map("isFeatured")
  ordem           Int       @default(0) @map("order")
  criadoEm        DateTime  @default(now()) @map("createdAt")
  atualizadoEm    DateTime  @updatedAt @map("updatedAt")

  // Relacionamentos
  parceiroId      String?   @map("partnerId")
  parceiro        Parceiro? @relation(fields: [parceiroId], references: [id], onDelete: SetNull)
  favoritos       Favorito[]

  @@map("Benefit")
}

// Parceiros
model Parceiro {
  id              String    @id @default(uuid())
  nome            String    @map("name")
  razaoSocial     String?   @map("corporateName")
  cnpj            String?
  email           String?
  telefone        String?   @map("phone")
  categoria       String    @map("category")
  desconto        String?   @map("discount")
  descricao       String?   @map("description")
  logo            String?
  site            String?   @map("website")
  status          String    @default("ATIVO") @map("status") // ATIVO, INATIVO, PENDENTE
  inicioContrato  DateTime? @map("contractStart")
  fimContrato     DateTime? @map("contractEnd")
  ativo           Boolean   @default(true) @map("isActive")
  criadoEm        DateTime  @default(now()) @map("createdAt")
  atualizadoEm    DateTime  @updatedAt @map("updatedAt")

  // Relacionamentos
  beneficios      Beneficio[]

  @@map("Partner")
}

// Favoritos de benefícios
model Favorito {
  id          String    @id @default(uuid())
  usuarioId   String    @map("userId")
  beneficioId String    @map("benefitId")
  usuario     Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  beneficio   Beneficio @relation(fields: [beneficioId], references: [id], onDelete: Cascade)
  criadoEm    DateTime  @default(now()) @map("createdAt")

  @@unique([usuarioId, beneficioId])
  @@map("Favorite")
}

// Documentos do associado
model Documento {
  id          String        @id @default(uuid())
  usuarioId   String        @map("userId")
  usuario     Usuario       @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  tipo        TipoDocumento @map("type")
  nomeArquivo String        @map("filename")
  caminho     String        @map("path")
  status      StatusDocumento @default(PENDENTE) @map("status")
  verificadoEm DateTime?    @map("verifiedAt")
  criadoEm    DateTime      @default(now()) @map("createdAt")

  @@map("Document")
}

enum TipoDocumento {
  CPF                 @map("CPF")
  RG                  @map("RG")
  COMPROVANTE_RESIDENCIA @map("COMPROVANTE_RESIDENCIA")
  FOTO                @map("FOTO")
  OUTRO               @map("OUTRO")
}

enum StatusDocumento {
  PENDENTE  @map("PENDING")
  APROVADO  @map("APPROVED")
  REJEITADO @map("REJECTED")
}

// Histórico de status do associado
model HistoricoMembership {
  id          String        @id @default(uuid())
  usuarioId   String        @map("userId")
  usuario     Usuario       @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  status      StatusAssociado @map("status")
  observacoes String?       @map("notes")
  criadoEm    DateTime      @default(now()) @map("createdAt")
  criadoPor   String?       @map("createdBy")

  @@map("MembershipHistory")
}
