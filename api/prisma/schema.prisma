// Schema do banco de dados - ASCESA
// Nomes em Português Brasileiro para tabelas e colunas

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Usuários do sistema
model Usuario {
  id            String      @id @default(uuid())
  email         String      @unique
  senha         String      @map("senha")
  nome          String      @map("nome")
  cpf           String?     @unique
  telefone      String?     @map("telefone")
  avatar        String?
  status        StatusUsuario @default(PENDENTE)
  papel         Papel        @default(ASSOCIADO)
  criadoEm      DateTime    @default(now()) @map("criado_em")
  atualizadoEm  DateTime    @updatedAt @map("atualizado_em")
  ultimoLogin   DateTime?   @map("ultimo_login")

  // Relacionamentos
  associado         Associado?
  administrador      Administrador?
  favoritos         Favorito[]
  redefinicaoSenha  RedefinicaoSenha?
  documentos        Documento[]
  historicosMembership HistoricoMembership[]
  pagamentos        Pagamento[]

  @@map("usuarios")
}

enum StatusUsuario {
  PENDENTE @map("pendente")
  ATIVO    @map("ativo")
  INATIVO  @map("inativo")
  SUSPENSO @map("suspenso")
}

enum Papel {
  ADMIN    @map("admin")
  DIRETOR  @map("diretor")
  ASSOCIADO @map("associado")
}

model RedefinicaoSenha {
  id          String   @id @default(uuid())
  usuarioId   String   @unique @map("usuario_id")
  usuario     Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  token       String
  expiraEm    DateTime @map("expira_em")
  usado       Boolean  @default(false) @map("usado")
  criadoEm    DateTime @default(now()) @map("criado_em")

  @@map("redefinicoes_senha")
}

// Dados específicos do associado
model Associado {
  id              String    @id @default(uuid())
  usuarioId       String    @unique @map("usuario_id")
  usuario         Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  cpf             String
  rg              String?
  dataNascimento  DateTime? @map("data_nascimento")
  profissao       String?   @map("profissao")
  endereco        String?   @map("endereco")
  cidade          String?   @map("cidade")
  estado          String?   @map("estado")
  cep             String?   @map("cep")
  dataAssociacao  DateTime  @default(now()) @map("data_associacao")
  tipoMembership  TipoMembership @default(PADRAO) @map("tipo_membership")
  status          StatusAssociado @default(ATIVO)
  statusPagamento StatusPagamento @default(PAGO) @map("status_pagamento")
  observacoes     String?   @map("observacoes")
  criadoEm        DateTime  @default(now()) @map("criado_em")
  atualizadoEm    DateTime  @updatedAt @map("atualizado_em")

  @@map("associados")
}

enum TipoMembership {
  PADRAO  @map("padrao")
  PREMIUM @map("premium")
  FAMILIA @map("familia")
}

enum StatusAssociado {
  ATIVO    @map("ativo")
  INATIVO  @map("inativo")
  PENDENTE @map("pendente")
  CANCELADO @map("cancelado")
}

enum StatusPagamento {
  PAGO     @map("pago")
  PENDENTE @map("pendente")
  ATRASADO @map("atrasado")
  CANCELADO @map("cancelado")
}

// Dados específicos do administrador
model Administrador {
  id              String    @id @default(uuid())
  usuarioId       String    @unique @map("usuario_id")
  usuario         Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  departamento    String?   @map("departamento")
  cargo           String?   @map("cargo")
  criadoEm        DateTime  @default(now()) @map("criado_em")
  atualizadoEm    DateTime  @updatedAt @map("atualizado_em")

  @@map("administradores")
}

// Convênios/Benefícios
model Beneficio {
  id              String    @id @default(uuid())
  nome            String    @map("nome")
  slug            String    @unique
  descricao       String?   @map("descricao")
  termos          String?   @map("termos")
  categoria       String    @map("categoria")
  nomeParceiro    String?   @map("nome_parceiro")
  logoParceiro    String?   @map("logo_parceiro")
  desconto        String?   @map("desconto")
  imagem          String?   @map("imagem")
  ativo           Boolean   @default(true) @map("ativo")
  destacado       Boolean   @default(false) @map("destacado")
  ordem           Int       @default(0) @map("ordem")
  criadoEm        DateTime  @default(now()) @map("criado_em")
  atualizadoEm    DateTime  @updatedAt @map("atualizado_em")

  // Relacionamentos
  parceiroId      String?   @map("parceiro_id")
  parceiro        Parceiro? @relation(fields: [parceiroId], references: [id], onDelete: SetNull)
  favoritos       Favorito[]

  @@map("beneficios")
}

// Parceiros
model Parceiro {
  id              String    @id @default(uuid())
  nome            String    @map("nome")
  razaoSocial     String?   @map("razao_social")
  cnpj            String?
  email           String?
  telefone        String?   @map("telefone")
  categoria       String    @map("categoria")
  desconto        String?   @map("desconto")
  descricao       String?   @map("descricao")
  logo            String?
  site            String?   @map("site")
  status          String    @default("ATIVO") @map("status")
  inicioContrato  DateTime? @map("inicio_contrato")
  fimContrato     DateTime? @map("fim_contrato")
  ativo           Boolean   @default(true) @map("ativo")
  criadoEm        DateTime  @default(now()) @map("criado_em")
  atualizadoEm    DateTime  @updatedAt @map("atualizado_em")

  // Relacionamentos
  beneficios      Beneficio[]

  @@map("parceiros")
}

// Favoritos de benefícios
model Favorito {
  id          String    @id @default(uuid())
  usuarioId   String    @map("usuario_id")
  beneficioId String    @map("beneficio_id")
  usuario     Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  beneficio   Beneficio @relation(fields: [beneficioId], references: [id], onDelete: Cascade)
  criadoEm    DateTime  @default(now()) @map("criado_em")

  @@unique([usuarioId, beneficioId])
  @@map("favoritos")
}

// Documentos do associado
model Documento {
  id          String        @id @default(uuid())
  usuarioId   String        @map("usuario_id")
  usuario     Usuario       @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  tipo        TipoDocumento @map("tipo")
  nomeArquivo String        @map("nome_arquivo")
  caminho     String        @map("caminho")
  status      StatusDocumento @default(PENDENTE) @map("status")
  verificadoEm DateTime?    @map("verificado_em")
  criadoEm    DateTime      @default(now()) @map("criado_em")

  @@map("documentos")
}

enum TipoDocumento {
  CPF                 @map("cpf")
  RG                  @map("rg")
  COMPROVANTE_RESIDENCIA @map("comprovante_residencia")
  FOTO                @map("foto")
  OUTRO               @map("outro")
}

enum StatusDocumento {
  PENDENTE  @map("pendente")
  APROVADO  @map("aprovado")
  REJEITADO @map("rejeitado")
}

// Histórico de status do associado
model HistoricoMembership {
  id          String        @id @default(uuid())
  usuarioId   String        @map("usuario_id")
  usuario     Usuario       @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  status      StatusAssociado @map("status")
  observacoes String?       @map("observacoes")
  criadoEm    DateTime      @default(now()) @map("criado_em")
  criadoPor   String?       @map("criado_por")

  @@map("historicos_membership")
}

// ============================================
// MÓDULO: Pagamentos
// ============================================

model Pagamento {
  id              String          @id @default(uuid())
  usuarioId       String          @map("usuario_id")
  usuario         Usuario         @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  mes             Int             @map("mes")
  ano             Int             @map("ano")
  valor           Float           @map("valor")
  dataVencimento  DateTime        @map("data_vencimento")
  dataPagamento   DateTime?       @map("data_pagamento")
  status          StatusPagamento @default(PENDENTE)
  metodoPagamento String?         @map("metodo_pagamento")
  transacaoId     String?         @map("transacao_id")
  observacoes     String?         @map("observacoes")
  criadoEm        DateTime        @default(now()) @map("criado_em")
  atualizadoEm    DateTime        @updatedAt @map("atualizado_em")

  @@map("pagamentos")
}

// ============================================
// MÓDULO: Vitrine Virtual (Produtos)
// ============================================

model Produto {
  id              String    @id @default(uuid())
  nome            String    @map("nome")
  descricao       String?   @map("descricao")
  preco           Float     @map("preco")
  precoOriginal   Float?    @map("preco_original")
  categoria       String    @map("categoria")
  imagens         String[]  @map("imagens")
  vendedor        String    @map("vendedor")
  contatoVendedor String    @map("contato_vendedor")
  condicao        CondicaoProduto @default(USADO) @map("condicao")
  visualizacoes   Int       @default(0) @map("visualizacoes")
  ativo           Boolean   @default(true) @map("ativo")
  usuarioId       String?   @map("usuario_id")
  criadoEm        DateTime  @default(now()) @map("criado_em")
  atualizadoEm    DateTime  @updatedAt @map("atualizado_em")

  @@map("produtos")
}

enum CondicaoProduto {
  NOVO      @map("novo")
  USADO     @map("usado")
  REFORMADO @map("reformado")
}

// ============================================
// MÓDULO: Fórum (Tópicos e Respostas)
// ============================================

model Topico {
  id            String    @id @default(uuid())
  titulo        String    @map("titulo")
  conteudo      String    @map("conteudo")
  categoria     String    @map("categoria")
  autor         String    @map("autor")
  usuarioId     String?   @map("usuario_id")
  fixado        Boolean   @default(false) @map("fixado")
  fechado       Boolean   @default(false) @map("fechado")
  visualizacoes Int      @default(0) @map("visualizacoes")
  respostas     Resposta[]
  criadoEm      DateTime  @default(now()) @map("criado_em")
  atualizadoEm  DateTime  @updatedAt @map("atualizado_em")

  @@map("topicos")
}

model Resposta {
  id          String    @id @default(uuid())
  topicoId    String    @map("topico_id")
  topico      Topico    @relation(fields: [topicoId], references: [id], onDelete: Cascade)
  conteudo    String    @map("conteudo")
  autor       String    @map("autor")
  usuarioId   String?   @map("usuario_id")
  criadoEm    DateTime  @default(now()) @map("criado_em")

  @@map("respostas")
}

// ============================================
// MÓDULO: Eventos
// ============================================

model Evento {
  id              String    @id @default(uuid())
  titulo          String    @map("titulo")
  descricao       String?   @map("descricao")
  data            DateTime  @map("data")
  horaInicio      String    @map("hora_inicio")
  horaFim         String    @map("hora_fim")
  local           String    @map("local")
  categoria       String    @map("categoria")
  online          Boolean   @default(false) @map("online")
  preco           Float     @default(0) @map("preco")
  vagas           Int       @default(0) @map("vagas")
  imagem          String?   @map("imagem")
  ativo           Boolean   @default(true) @map("ativo")
  inscricoes      InscricaoEvento[]
  criadoEm        DateTime  @default(now()) @map("criado_em")
  atualizadoEm    DateTime  @updatedAt @map("atualizado_em")

  @@map("eventos")
}

model InscricaoEvento {
  id          String    @id @default(uuid())
  eventoId    String    @map("evento_id")
  evento      Evento    @relation(fields: [eventoId], references: [id], onDelete: Cascade)
  usuarioId   String    @map("usuario_id")
  nome        String    @map("nome")
  email       String    @map("email")
  criadoEm    DateTime  @default(now()) @map("criado_em")

  @@unique([eventoId, usuarioId])
  @@map("inscricoes_evento")
}

// ============================================
// MÓDULO: Assembleias e Votações
// ============================================

model Assembleia {
  id          String    @id @default(uuid())
  titulo      String    @map("titulo")
  tipo        TipoAssembleia @map("tipo")
  data        DateTime  @map("data")
  hora        String    @map("hora")
  local       String    @map("local")
  descricao   String?   @map("descricao")
  status      StatusAssembleia @default(AGENDADA) @map("status")
  totalVotos  Int       @default(0) @map("total_votos")
  candidatos  Candidato[]
  votos       Voto[]
  criadoEm    DateTime  @default(now()) @map("criado_em")
  atualizadoEm DateTime  @updatedAt @map("atualizado_em")

  @@map("assembleias")
}

enum TipoAssembleia {
  ORDINARIA      @map("ordinaria")
  EXTRAORDINARIA @map("extraordinaria")
}

enum StatusAssembleia {
  AGENDADA     @map("agendada")
  EM_ANDAMENTO @map("em_andamento")
  ENCERRADA    @map("encerrada")
  CANCELADA    @map("cancelada")
}

model Candidato {
  id            String    @id @default(uuid())
  assembleiaId  String    @map("assembleia_id")
  assembleia    Assembleia @relation(fields: [assembleiaId], references: [id], onDelete: Cascade)
  nome          String    @map("nome")
  cargo         String    @map("cargo")
  foto          String?   @map("foto")
  votos         Int       @default(0) @map("votos")
  votosList    Voto[]    @relation("CandidateVotes")
  criadoEm      DateTime  @default(now()) @map("criado_em")

  @@map("candidatos")
}

model Voto {
  id            String    @id @default(uuid())
  assembleiaId  String    @map("assembleia_id")
  assembleia    Assembleia @relation(fields: [assembleiaId], references: [id], onDelete: Cascade)
  candidatoId   String    @map("candidato_id")
  candidato     Candidato @relation("CandidateVotes", fields: [candidatoId], references: [id], onDelete: Cascade)
  usuarioId     String    @map("usuario_id")
  criadoEm      DateTime  @default(now()) @map("criado_em")

  @@unique([assembleiaId, usuarioId])
  @@map("votos")
}
