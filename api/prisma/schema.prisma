// Schema do banco de dados - ASCESA
// Usando nomes em Português Brasileiro

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Usuários do sistema
model Usuario {
  id            String      @id @default(uuid())
  email         String      @unique
  senha         String      @map("password")
  nome          String      @map("name")
  cpf           String?     @unique
  telefone       String?     @map("phone")
  avatar        String?
  status        StatusUsuario @default(PENDENTE)
  papel         Papel        @default(ASSOCIADO)
  criadoEm      DateTime    @default(now()) @map("createdAt")
  atualizadoEm  DateTime    @updatedAt @map("updatedAt")
  ultimoLogin   DateTime?   @map("lastLogin")

  // Relacionamentos
  associado      Associado?
  administrador  Administrador?
  favoritos      Favorito[]
  redefinicaoSenha RedefinicaoSenha?
  documentos     Documento[]
  historicosMembership HistoricoMembership[]
  pagamentos     Pagamento[]

  @@map("User")
}

enum StatusUsuario {
  PENDENTE @map("PENDING")
  ATIVO    @map("ACTIVE")
  INATIVO  @map("INACTIVE")
  SUSPENSO @map("SUSPENDED")
}

enum Papel {
  ADMIN    @map("ADMIN")
  DIRETOR  @map("DIRECTOR")
  ASSOCIADO @map("ASSOCIATED")
}

model RedefinicaoSenha {
  id          String   @id @default(uuid())
  usuarioId   String   @unique @map("userId")
  usuario     Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  token       String
  expiraEm    DateTime @map("expiresAt")
  usado       Boolean  @default(false) @map("used")
  criadoEm    DateTime @default(now()) @map("createdAt")

  @@map("PasswordReset")
}

// Dados específicos do associado
model Associado {
  id              String    @id @default(uuid())
  usuarioId       String    @unique @map("userId")
  usuario         Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  cpf             String
  rg              String?
  dataNascimento  DateTime? @map("birthDate")
  profissao       String?   @map("profession")
  endereco        String?   @map("address")
  cidade          String?   @map("city")
  estado          String?   @map("state")
  cep             String?   @map("zipCode")
  dataAssociacao  DateTime  @default(now()) @map("membershipDate")
  tipoMembership   TipoMembership @default(PADRAO) @map("membershipType")
  status          StatusAssociado @default(ATIVO)
  statusPagamento StatusPagamento @default(PAGO) @map("paymentStatus")
  observacoes     String?   @map("notes")
  criadoEm        DateTime  @default(now()) @map("createdAt")
  atualizadoEm    DateTime  @updatedAt @map("updatedAt")

  @@map("Associated")
}

enum TipoMembership {
  PADRAO  @map("STANDARD")
  PREMIUM @map("PREMIUM")
  FAMILIA @map("FAMILY")
}

enum StatusAssociado {
  ATIVO   @map("ACTIVE")
  INATIVO @map("INACTIVE")
  PENDENTE @map("PENDING")
  CANCELADO @map("CANCELLED")
}

enum StatusPagamento {
  PAGO     @map("PAID")
  PENDENTE @map("PENDING")
  ATRASADO @map("OVERDUE")
  CANCELADO @map("CANCELLED")
}

// Dados específicos do administrador
model Administrador {
  id              String    @id @default(uuid())
  usuarioId       String    @unique @map("userId")
  usuario         Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  departamento    String?   @map("department")
  cargo           String?   @map("position")
  criadoEm        DateTime  @default(now()) @map("createdAt")
  atualizadoEm    DateTime  @updatedAt @map("updatedAt")

  @@map("Admin")
}

// Convênios/Benefícios
model Beneficio {
  id              String    @id @default(uuid())
  nome            String    @map("name")
  slug            String    @unique
  descricao       String?   @map("description")
  termos          String?   @map("terms")
  categoria       String    @map("category")
  nomeParceiro    String?   @map("partnerName")
  logoParceiro    String?   @map("partnerLogo")
  desconto        String?   @map("discount")
  imagem          String?   @map("image")
  ativo           Boolean   @default(true) @map("isActive")
  destacado       Boolean   @default(false) @map("isFeatured")
  ordem           Int       @default(0) @map("order")
  criadoEm        DateTime  @default(now()) @map("createdAt")
  atualizadoEm    DateTime  @updatedAt @map("updatedAt")

  // Relacionamentos
  parceiroId      String?   @map("partnerId")
  parceiro        Parceiro? @relation(fields: [parceiroId], references: [id], onDelete: SetNull)
  favoritos       Favorito[]

  @@map("Benefit")
}

// Parceiros
model Parceiro {
  id              String    @id @default(uuid())
  nome            String    @map("name")
  razaoSocial     String?   @map("corporateName")
  cnpj            String?
  email           String?
  telefone        String?   @map("phone")
  categoria       String    @map("category")
  desconto        String?   @map("discount")
  descricao       String?   @map("description")
  logo            String?
  site            String?   @map("website")
  status          String    @default("ATIVO") @map("status") // ATIVO, INATIVO, PENDENTE
  inicioContrato  DateTime? @map("contractStart")
  fimContrato     DateTime? @map("contractEnd")
  ativo           Boolean   @default(true) @map("isActive")
  criadoEm        DateTime  @default(now()) @map("createdAt")
  atualizadoEm    DateTime  @updatedAt @map("updatedAt")

  // Relacionamentos
  beneficios      Beneficio[]

  @@map("Partner")
}

// Favoritos de benefícios
model Favorito {
  id          String    @id @default(uuid())
  usuarioId   String    @map("userId")
  beneficioId String    @map("benefitId")
  usuario     Usuario   @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  beneficio   Beneficio @relation(fields: [beneficioId], references: [id], onDelete: Cascade)
  criadoEm    DateTime  @default(now()) @map("createdAt")

  @@unique([usuarioId, beneficioId])
  @@map("Favorite")
}

// Documentos do associado
model Documento {
  id          String        @id @default(uuid())
  usuarioId   String        @map("userId")
  usuario     Usuario       @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  tipo        TipoDocumento @map("type")
  nomeArquivo String        @map("filename")
  caminho     String        @map("path")
  status      StatusDocumento @default(PENDENTE) @map("status")
  verificadoEm DateTime?    @map("verifiedAt")
  criadoEm    DateTime      @default(now()) @map("createdAt")

  @@map("Document")
}

enum TipoDocumento {
  CPF                 @map("CPF")
  RG                  @map("RG")
  COMPROVANTE_RESIDENCIA @map("COMPROVANTE_RESIDENCIA")
  FOTO                @map("FOTO")
  OUTRO               @map("OUTRO")
}

enum StatusDocumento {
  PENDENTE  @map("PENDING")
  APROVADO  @map("APPROVED")
  REJEITADO @map("REJECTED")
}

// Histórico de status do associado
model HistoricoMembership {
  id          String        @id @default(uuid())
  usuarioId   String        @map("userId")
  usuario     Usuario       @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  status      StatusAssociado @map("status")
  observacoes String?       @map("notes")
  criadoEm    DateTime      @default(now()) @map("createdAt")
  criadoPor   String?       @map("createdBy")

  @@map("MembershipHistory")
}

// ============================================
// MÓDULO: Pagamentos
// ============================================

model Pagamento {
  id              String          @id @default(uuid())
  usuarioId       String          @map("userId")
  usuario         Usuario         @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  mes             Int             @map("month")
  ano             Int             @map("year")
  valor           Float           @map("amount")
  dataVencimento  DateTime        @map("dueDate")
  dataPagamento   DateTime?      @map("paidDate")
  status          StatusPagamento @default(PENDENTE)
  metodoPagamento String?        @map("paymentMethod")
  transacaoId     String?        @map("transactionId")
  observacoes     String?        @map("notes")
  criadoEm        DateTime        @default(now()) @map("createdAt")
  atualizadoEm    DateTime        @updatedAt @map("updatedAt")

  @@map("Payment")
}

// ============================================
// MÓDULO: Vitrine Virtual (Produtos)
// ============================================

model Produto {
  id              String    @id @default(uuid())
  nome            String    @map("name")
  descricao       String?   @map("description")
  preco           Float     @map("price")
  precoOriginal   Float?    @map("originalPrice")
  categoria       String    @map("category")
  imagens         String[]  @map("images")
  vendedor        String    @map("seller")
  contatoVendedor String   @map("sellerContact")
  condicao        CondicaoProduto @default(USADO) @map("condition")
  visualizacoes   Int       @default(0) @map("views")
  ativo           Boolean   @default(true) @map("isActive")
  usuarioId       String?   @map("userId")
  criadoEm        DateTime  @default(now()) @map("createdAt")
  atualizadoEm    DateTime  @updatedAt @map("updatedAt")

  @@map("Product")
}

enum CondicaoProduto {
  NOVO   @map("NEW")
  USADO  @map("USED")
  REFORMADO @map("REFURBISHED")
}

// ============================================
// MÓDULO: Fórum (Tópicos e Respostas)
// ============================================

model Topico {
  id          String    @id @default(uuid())
  titulo       String    @map("title")
  conteudo    String    @map("content")
  categoria   String    @map("category")
  autor       String    @map("author")
  usuarioId   String?   @map("userId")
  fixado      Boolean   @default(false) @map("isPinned")
  fechado     Boolean   @default(false) @map("isLocked")
  visualizacoes Int    @default(0) @map("views")
  respostas    Resposta[]
  criadoEm    DateTime  @default(now()) @map("createdAt")
  atualizadoEm DateTime  @updatedAt @map("updatedAt")

  @@map("Topic")
}

model Resposta {
  id          String    @id @default(uuid())
  topicoId    String    @map("topicId")
  topico      Topico    @relation(fields: [topicoId], references: [id], onDelete: Cascade)
  conteudo    String    @map("content")
  autor       String    @map("author")
  usuarioId   String?   @map("userId")
  criadoEm    DateTime  @default(now()) @map("createdAt")

  @@map("Reply")
}

// ============================================
// MÓDULO: Eventos
// ============================================

model Evento {
  id              String    @id @default(uuid())
  titulo          String    @map("title")
  descricao       String?   @map("description")
  data            DateTime  @map("date")
  horaInicio      String    @map("startTime")
  horaFim         String    @map("endTime")
  local           String    @map("location")
  categoria       String    @map("category")
  online           Boolean  @default(false) @map("isOnline")
  preco           Float     @default(0) @map("price")
  vagas           Int       @default(0) @map("spots")
  imagem          String?   @map("image")
  ativo           Boolean   @default(true) @map("isActive")
  inscricoes      InscricaoEvento[]
  criadoEm        DateTime  @default(now()) @map("createdAt")
  atualizadoEm    DateTime  @updatedAt @map("updatedAt")

  @@map("Event")
}

model InscricaoEvento {
  id          String    @id @default(uuid())
  eventoId    String    @map("eventId")
  evento      Evento    @relation(fields: [eventoId], references: [id], onDelete: Cascade)
  usuarioId   String    @map("userId")
  nome        String    @map("name")
  email       String    @map("email")
  criadoEm    DateTime  @default(now()) @map("createdAt")

  @@unique([eventoId, usuarioId])
  @@map("EventRegistration")
}

// ============================================
// MÓDULO: Assembleias e Votações
// ============================================

model Assembleia {
  id          String    @id @default(uuid())
  titulo      String    @map("title")
  tipo        TipoAssembleia @map("type")
  data        DateTime  @map("date")
  hora        String    @map("time")
  local       String    @map("location")
  descricao   String?   @map("description")
  status      StatusAssembleia @default(AGENDADA) @map("status")
  totalVotos  Int       @default(0) @map("totalVotes")
  candidatos  Candidato[]
  votos       Voto[]
  criadoEm    DateTime  @default(now()) @map("createdAt")
  atualizadoEm DateTime  @updatedAt @map("updatedAt")

  @@map("Assembly")
}

enum TipoAssembleia {
  ORDINARIA   @map("ORDINARY")
  EXTRAORDINARIA @map("EXTRAORDINARY")
}

enum StatusAssembleia {
  AGENDADA    @map("SCHEDULED")
  EM_ANDAMENTO @map("IN_PROGRESS")
  ENCERRADA   @map("COMPLETED")
  CANCELADA   @map("CANCELLED")
}

model Candidato {
  id          String    @id @default(uuid())
  assembleiaId String   @map("assemblyId")
  assembleia  Assembleia @relation(fields: [assembleiaId], references: [id], onDelete: Cascade)
  nome        String    @map("name")
  cargo       String    @map("role")
  foto        String?   @map("photo")
  votos       Int       @default(0) @map("votes")
  votosList   Voto[]    @relation("CandidateVotes")
  criadoEm    DateTime  @default(now()) @map("createdAt")

  @@map("Candidate")
}

model Voto {
  id          String    @id @default(uuid())
  assembleiaId String   @map("assemblyId")
  assembleia  Assembleia @relation(fields: [assembleiaId], references: [id], onDelete: Cascade)
  candidatoId String   @map("candidateId")
  candidato   Candidato @relation("CandidateVotes", fields: [candidatoId], references: [id], onDelete: Cascade)
  usuarioId   String    @map("userId")
  criadoEm    DateTime  @default(now()) @map("createdAt")

  @@unique([assembleiaId, usuarioId])
  @@map("Vote")
}
