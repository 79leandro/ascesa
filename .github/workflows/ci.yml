name: CI

  on:
    push:
      branches:
        - master
        - develop
    pull_request:
      branches:
        - master
        - develop

  jobs:
    lint-and-test:
      runs-on: ubuntu-latest

      steps:
        - name: Checkout code
          uses: actions/checkout@v4

        - name: Setup Node.js
          uses: actions/setup-node@v4
          with:
            node-version: '20'
            cache: 'false'

        - name: Install API dependencies
          working-directory: ./api
          run: npm install

        - name: Install Web dependencies
          working-directory: ./web
          run: npm install

        - name: Lint API
          working-directory: ./api
          run: npm run lint
          continue-on-error: true

        - name: Lint Web
          working-directory: ./web
          run: npm run lint
          continue-on-error: true

        - name: Run API tests
          working-directory: ./api
          run: npm run test
          continue-on-error: true

    build:
      runs-on: ubuntu-latest
      needs: lint-and-test

      steps:
        - name: Checkout code
          uses: actions/checkout@v4

        - name: Setup Node.js
          uses: actions/setup-node@v4
          with:
            node-version: '20'
            cache: 'false'

        - name: Install API dependencies
          working-directory: ./api
          run: npm install

        - name: Install Web dependencies
          working-directory: ./web
          run: npm install

        - name: Build API
          working-directory: ./api
          run: npm run build

        - name: Build Web
          working-directory: ./web
          run: npm run build
